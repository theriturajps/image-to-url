<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuickPix - Free Image Upload & Live URL Generator | Instant Image Hosting</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description"
    content="QuickPix - Upload images instantly and get live URLs for free. Fast, secure, and reliable image hosting service. No registration required. Perfect for sharing images online.">
  <meta name="keywords"
    content="free image upload, image hosting, live url generator, instant image sharing, free image host, image uploader, quickpix, image converter, png to jpg, webp converter">
  <meta name="author" content="QuickPix">
  <meta name="robots" content="index, follow">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="QuickPix - Free Image Upload & Live URL Generator">
  <meta property="og:description"
    content="Upload images instantly and get live URLs for free. Fast, secure, and reliable image hosting service.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://theriturajps.github.io/quickpix/">
  <meta property="og:image" content="https://theriturajps.github.io/quickpix/og-image.jpg">
  <meta property="og:site_name" content="QuickPix">
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="QuickPix - Free Image Upload & Live URL Generator">
  <meta name="twitter:description"
    content="Upload images instantly and get live URLs for free. Fast, secure, and reliable image hosting service.">
  <meta name="twitter:image" content="https://theriturajps.github.io/quickpix/og-image.jpg">
  
  <!-- Additional SEO Meta Tags -->
  <meta name="theme-color" content="#6366f1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="QuickPix">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://theriturajps.github.io/quickpix/">
  
  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://api.imgbb.com">
  <link rel="preconnect" href="https://cors-anywhere.herokuapp.com">
  <link rel="preconnect" href="https://api.codetabs.com">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,
                                        <svg
                                            xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236366f1'>
                                            <path d='M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm16 2H4v12h16V6zM8 8l4 4 4-4-1.5 1.5L12 8l-2.5 1.5L8 8z'/>
                                        </svg>">
  
  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "QuickPix",
        "description": "Free image upload and live URL generator service with format conversion",
        "url": "https://theriturajps.github.io/quickpix/",
        "applicationCategory": "UtilityApplication",
        "operatingSystem": "Any",
        "browserRequirements": "Requires JavaScript. Requires HTML5.",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "featureList": [
          "Free image hosting",
          "Instant URL generation",
          "Image format conversion",
          "Drag and drop upload",
          "URL-based image upload",
          "No registration required"
        ],
        "screenshot": "https://theriturajps.github.io/quickpix/screenshot.jpg"
      }
    </script>
  
  <style>
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --accent: #6366f1;
      --accent-hover: #4f46e5;
      --border: #e2e8f0;
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --transition: all 0.2s ease;
    }

    [data-theme="dark"] {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --border: #334155;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.5;
      font-size: 14px;
      transition: var(--transition);
    }

    @media (min-width: 640px) {
      body {
        font-size: 15px;
      }
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      text-align: center;
      margin-bottom: 24px;
      position: relative;
    }

    .theme-toggle {
      position: absolute;
      top: 0;
      right: 0;
      background: none;
      border: none;
      border-radius: var(--radius-md);
      width: 36px;
      height: 36px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
      color: var(--text-secondary);
      font-size: 16px;
    }

    .theme-toggle:hover {
      color: var(--accent);
      background: var(--bg-secondary);
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 4px;
      letter-spacing: -0.5px;
    }

    .tagline {
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-bottom: 12px;
    }

    .features {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .feature {
      display: flex;
      align-items: center;
      gap: 4px;
      color: var(--text-secondary);
      font-size: 0.8rem;
      font-weight: 500;
    }

    .upload-tabs {
      display: flex;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 4px;
      margin-bottom: 16px;
    }

    .tab-btn {
      flex: 1;
      padding: 8px 12px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
      font-size: 0.85rem;
    }

    .tab-btn.active {
      background: var(--accent);
      color: white;
      font-weight: 600;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .upload-section {
      background: var(--bg-secondary);
      border: 2px dashed var(--border);
      border-radius: var(--radius-md);
      padding: 20px 16px;
      text-align: center;
      margin-bottom: 16px;
      transition: var(--transition);
      cursor: pointer;
    }

    .upload-section:hover {
      border-color: var(--accent);
      background: var(--bg-primary);
    }

    .upload-section.dragover {
      border-color: var(--accent);
      background: var(--accent);
      color: white;
    }

    .url-upload-section {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 16px;
      text-align: center;
    }

    .upload-icon {
      font-size: 2rem;
      margin-bottom: 12px;
      opacity: 0.7;
    }

    .upload-text {
      font-size: 0.95rem;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .upload-subtext {
      color: var(--text-secondary);
      font-size: 0.8rem;
      margin-bottom: 16px;
    }

    .file-input {
      display: none;
    }

    .btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: var(--radius-md);
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 0.8rem;
    }

    .btn-success {
      background: var(--success);
    }

    .btn-warning {
      background: var(--warning);
    }

    #urlSubmitBtn {
      margin-top: 10px;
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn-warning:hover {
      background: #d97706;
    }

    .btn-outline {
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--border);
    }

    .btn-outline:hover {
      background: var(--bg-primary);
      color: var(--text-primary);
      border-color: var(--accent);
    }

    .input-group {
      margin-bottom: 12px;
    }

    .input-label {
      display: block;
      margin-bottom: 6px;
      color: var(--text-secondary);
      font-size: 0.8rem;
      font-weight: 500;
    }

    .input-field {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 0.85rem;
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: var(--transition);
    }

    .input-field:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
    }

    .preview-section,
    .result-section {
      display: none;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 16px;
    }

    .preview-image,
    .result-image {
      width: 100%;
      max-height: 180px;
      object-fit: contain;
      border-radius: var(--radius-md);
      margin-bottom: 12px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
    }

    .progress-bar {
      width: 100%;
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      overflow: hidden;
      margin: 12px 0;
      display: none;
    }

    .progress-fill {
      height: 100%;
      background: var(--accent);
      width: 0%;
      transition: width 0.3s ease;
    }

    .controls {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .controls .btn {
      flex: 1;
    }

    .url-container {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .url-container .input-field {
      flex: 1;
    }

    .error-message {
      background: #fef2f2;
      color: var(--error);
      padding: 10px 12px;
      border-radius: var(--radius-md);
      margin-bottom: 16px;
      border: 1px solid #fecaca;
      font-size: 0.85rem;
      display: none;
    }

    .warning-message {
      background: #fffbeb;
      color: var(--warning);
      padding: 10px 12px;
      border-radius: var(--radius-md);
      margin-bottom: 16px;
      border: 1px solid #fed7aa;
      font-size: 0.85rem;
      display: none;
    }

    [data-theme="dark"] .error-message {
      background: #371c1c;
      border-color: #7f1d1d;
    }

    [data-theme="dark"] .warning-message {
      background: #451a03;
      border-color: #92400e;
    }

    .filename-preview {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 4px;
      font-style: italic;
    }

    .cors-notice {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 12px;
      margin-top: 12px;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .cors-notice strong {
      color: var(--text-primary);
    }

    footer {
      margin-top: auto;
      text-align: center;
      padding: 16px 0;
      color: var(--text-secondary);
      font-size: 0.8rem;
    }

    .loading {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.6;
      }
    }

    /* Responsive adjustments */
    @media (max-width: 400px) {
      .container {
        padding: 12px;
      }

      .logo {
        font-size: 1.6rem;
      }

      .features {
        gap: 12px;
      }

      .feature span:first-child {
        display: none;
      }

      .upload-section,
      .url-upload-section {
        padding: 16px 12px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme"> üåô </button>
      <h1 class="logo">QuickPix</h1>
      <p class="tagline">Instant image hosting with live URLs</p>
      <div class="features">
        <div class="feature">
          <span>‚ö°</span>
          <span>Instant</span>
        </div>
        <div class="feature">
          <span>üîí</span>
          <span>Secure</span>
        </div>
        <div class="feature">
          <span>üÜì</span>
          <span>Free</span>
        </div>
        <div class="feature">
          <span>üîÑ</span>
          <span>Convert</span>
        </div>
      </div>
    </header>
    
    <main>
      <div class="error-message" id="errorMessage"></div>
      <div class="warning-message" id="warningMessage"></div>
      
      <div class="upload-tabs">
        <button class="tab-btn active" id="fileTab">File Upload</button>
        <button class="tab-btn" id="urlTab">URL Upload</button>
      </div>
      
      <div class="tab-content active" id="fileContent">
        <div class="upload-section" id="uploadSection">
          <div class="upload-icon">üì∏</div>
          <div class="upload-text">Drop your image here</div>
          <div class="upload-subtext">or click to browse (max 32MB)</div>
          <input type="file" class="file-input" id="fileInput" accept="image/*">
          <button class="btn" id="uploadBtn">Choose Image</button>
        </div>
      </div>
      
      <div class="tab-content" id="urlContent">
        <div class="url-upload-section">
          <div class="upload-icon">üåê</div>
          <div class="upload-text">Upload from URL</div>
          <div class="upload-subtext">Enter an image URL to upload</div>
          <div class="input-group">
            <input type="url" class="input-field" id="imageUrlInput" placeholder="https://example.com/image.jpg">
            <button class="btn btn-success" id="urlSubmitBtn">Load Image</button>
          </div>
          <div class="cors-notice">
            <strong>Note:</strong> Some websites block direct image loading due to security policies. If an image fails to load, try downloading it first and using the file upload instead.
          </div>
        </div>
      </div>
      
      <div class="preview-section" id="previewSection">
        <img class="preview-image" id="previewImage" alt="Image preview">
        <div class="input-group">
          <label for="filenameInput" class="input-label">Image name (optional):</label>
          <input type="text" class="input-field" id="filenameInput" placeholder="e.g., my-awesome-image">
          <div class="filename-preview" id="filenamePreview"></div>
        </div>
        <div class="input-group">
          <label for="formatSelect" class="input-label">Output format:</label>
          <select class="input-field" id="formatSelect">
            <option value="original">Keep original format</option>
            <option value="jpg">JPEG (.jpg)</option>
            <option value="png">PNG (.png)</option>
            <option value="webp">WebP (.webp)</option>
          </select>
        </div>
        <div class="controls">
          <button class="btn btn-success" id="uploadConfirmBtn">Upload</button>
          <button class="btn btn-outline" id="cancelBtn">Cancel</button>
        </div>
        <div class="progress-bar" id="progressBar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>
      
      <div class="result-section" id="resultSection">
        <img class="result-image" id="resultImage" alt="Uploaded image">
        <div class="url-container">
          <input type="text" class="input-field" id="urlResultInput" readonly>
          <button class="btn btn-sm" id="copyBtn">Copy</button>
        </div>
        <button class="btn btn-outline" id="resetBtn">Upload Another</button>
      </div>
    </main>
    
    <footer>
      <p>&copy; 2025 QuickPix. Free image hosting service.</p>
    </footer>
  </div>

  <script>
    // Theme management
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    function setTheme(theme) {
      if (theme === 'system') {
        const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        body.setAttribute('data-theme', systemTheme);
        themeToggle.textContent = 'üíª';
      } else {
        body.setAttribute('data-theme', theme);
        themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      }
      localStorage.setItem('theme', theme);
    }

    function getNextTheme(currentTheme) {
      const themes = ['light', 'dark', 'system'];
      const currentIndex = themes.indexOf(currentTheme);
      return themes[(currentIndex + 1) % themes.length];
    }

    // Initialize theme
    const savedTheme = localStorage.getItem('theme') || 'system';
    setTheme(savedTheme);
    themeToggle.addEventListener('click', () => {
      const currentTheme = localStorage.getItem('theme') || 'system';
      const nextTheme = getNextTheme(currentTheme);
      setTheme(nextTheme);
    });

    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
      if (localStorage.getItem('theme') === 'system') {
        setTheme('system');
      }
    });

    // Tab functionality
    const fileTab = document.getElementById('fileTab');
    const urlTab = document.getElementById('urlTab');
    const fileContent = document.getElementById('fileContent');
    const urlContent = document.getElementById('urlContent');

    function switchTab(activeTab, activeContent) {
      document.querySelectorAll('.tab-btn').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      activeTab.classList.add('active');
      activeContent.classList.add('active');
      resetUI();
    }

    fileTab.addEventListener('click', () => switchTab(fileTab, fileContent));
    urlTab.addEventListener('click', () => switchTab(urlTab, urlContent));

    // File upload functionality
    const uploadSection = document.getElementById('uploadSection');
    const fileInput = document.getElementById('fileInput');
    const uploadBtn = document.getElementById('uploadBtn');
    const imageUrlInput = document.getElementById('imageUrlInput');
    const urlSubmitBtn = document.getElementById('urlSubmitBtn');
    const previewSection = document.getElementById('previewSection');
    const previewImage = document.getElementById('previewImage');
    const filenameInput = document.getElementById('filenameInput');
    const filenamePreview = document.getElementById('filenamePreview');
    const formatSelect = document.getElementById('formatSelect');
    const uploadConfirmBtn = document.getElementById('uploadConfirmBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const resultSection = document.getElementById('resultSection');
    const resultImage = document.getElementById('resultImage');
    const urlResultInput = document.getElementById('urlResultInput');
    const copyBtn = document.getElementById('copyBtn');
    const resetBtn = document.getElementById('resetBtn');
    const errorMessage = document.getElementById('errorMessage');
    const warningMessage = document.getElementById('warningMessage');

    // ImgBB API key
    const IMGBB_API_KEY = '04c10fc49b812442e1e6adacbb1896b2';
    let selectedFile = null;
    let isFromUrl = false;
    let originalFileName = '';

    // Professional filename handling functions
    function getFileExtension(filename) {
      const lastDot = filename.lastIndexOf('.');
      return lastDot !== -1 ? filename.substring(lastDot + 1).toLowerCase() : '';
    }

    function getFileNameWithoutExtension(filename) {
      const lastDot = filename.lastIndexOf('.');
      return lastDot !== -1 ? filename.substring(0, lastDot) : filename;
    }

    function createSlug(text) {
      return text
        .toLowerCase()
        .trim()
        .replace(/[^\w\s-]/g, '') // Remove special characters except spaces and hyphens
        .replace(/[\s_-]+/g, '-') // Replace spaces, underscores, and multiple hyphens with single hyphen
        .replace(/^-+|-+$/g, '') // Remove leading and trailing hyphens
        .substring(0, 50); // Limit to 50 characters
    }

    function generateFinalFilename(customName, originalFile, targetFormat) {
      let baseName;
      
      if (customName && customName.trim()) {
        // Use custom name, create slug
        baseName = createSlug(customName.trim());
      } else {
        // Use original filename without extension, create slug
        const originalNameWithoutExt = getFileNameWithoutExtension(originalFile.name);
        baseName = createSlug(originalNameWithoutExt);
      }

      // If baseName is empty after processing, use a default
      if (!baseName) {
        baseName = 'image';
      }

      // Determine the extension
      let extension;
      if (targetFormat === 'original') {
        extension = getFileExtension(originalFile.name);
        // Handle edge case where original file has no extension
        if (!extension) {
          extension = originalFile.type.split('/')[1] || 'jpg';
        }
      } else {
        extension = targetFormat;
      }

      return `${baseName}.${extension}`;
    }

    function updateFilenamePreview() {
      if (!selectedFile) {
        filenamePreview.textContent = '';
        return;
      }

      const customName = filenameInput.value;
      const targetFormat = formatSelect.value;
      const finalFilename = generateFinalFilename(customName, selectedFile, targetFormat);
      
      filenamePreview.textContent = `Final filename: ${finalFilename}`;
    }

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      warningMessage.style.display = 'none';
      setTimeout(() => {
        errorMessage.style.display = 'none';
      }, 8000);
    }

    function showWarning(message) {
      warningMessage.textContent = message;
      warningMessage.style.display = 'block';
      errorMessage.style.display = 'none';
      setTimeout(() => {
        warningMessage.style.display = 'none';
      }, 10000);
    }

    function hideMessages() {
      errorMessage.style.display = 'none';
      warningMessage.style.display = 'none';
    }

    function validateFile(file) {
      if (!file) {
        showError('Please select a file');
        return false;
      }
      if (!file.type.startsWith('image/')) {
        showError('Please select an image file');
        return false;
      }
      if (file.size > 32 * 1024 * 1024) {
        showError('File size must be less than 32MB');
        return false;
      }
      return true;
    }

    function isValidImageUrl(url) {
      try {
        new URL(url);
        return /\.(jpg|jpeg|png|gif|webp|bmp|svg|avif|jxl|tiff?)(\?.*)?$/i.test(url) ||
          url.includes('image') ||
          url.includes('img') ||
          url.includes('photo') ||
          url.includes('picture');
      } catch {
        return false;
      }
    }

    function updateProgress(percent) {
      progressFill.style.width = percent + '%';
    }

    function resetUI() {
      uploadSection.style.display = 'block';
      previewSection.style.display = 'none';
      resultSection.style.display = 'none';
      progressBar.style.display = 'none';
      uploadBtn.disabled = false;
      urlSubmitBtn.disabled = false;
      uploadConfirmBtn.disabled = false;
      uploadConfirmBtn.textContent = 'Upload';
      urlSubmitBtn.textContent = 'Load Image';
      updateProgress(0);
      hideMessages();
      filenameInput.value = '';
      filenamePreview.textContent = '';
      imageUrlInput.value = '';
      formatSelect.value = 'original';
      selectedFile = null;
      isFromUrl = false;
      originalFileName = '';
    }

    // Multiple proxy services for better reliability
    const proxyServices = [
      {
        name: 'CodeTabs',
        url: (imageUrl) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(imageUrl)}`,
        headers: {}
      },
      {
        name: 'AllOrigins',
        url: (imageUrl) => `https://api.allorigins.win/raw?url=${encodeURIComponent(imageUrl)}`,
        headers: {}
      },
      {
        name: 'ThingProxy',
        url: (imageUrl) => `https://thingproxy.freeboard.io/fetch/${encodeURIComponent(imageUrl)}`,
        headers: {}
      }
    ];

    async function loadImageFromUrl(url) {
      if (!url.trim()) {
        showError('Please enter a valid image URL');
        return;
      }
      if (!isValidImageUrl(url)) {
        showError('Please enter a valid image URL (must end with image extension or contain image-related keywords)');
        return;
      }

      hideMessages();
      urlSubmitBtn.disabled = true;
      urlSubmitBtn.textContent = 'Loading...';

      // Try direct fetch first (for CORS-enabled URLs)
      try {
        const directResponse = await fetch(url, { 
          method: 'HEAD',
          mode: 'no-cors'
        });
        
        // If we get here without error, try to load the image directly
        const img = new Image();
        img.crossOrigin = 'anonymous';
        
        const imageLoadPromise = new Promise((resolve, reject) => {
          img.onload = () => {
            // Convert image to blob
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            
            canvas.toBlob((blob) => {
              if (blob) {
                resolve(blob);
              } else {
                reject(new Error('Failed to convert image to blob'));
              }
            }, 'image/png');
          };
          
          img.onerror = () => reject(new Error('Failed to load image directly'));
          
          // Timeout after 10 seconds
          setTimeout(() => reject(new Error('Image loading timeout')), 10000);
        });
        
        img.src = url;
        
        try {
          const blob = await imageLoadPromise;
          const urlPath = new URL(url).pathname;
          const filename = urlPath.split('/').pop() || 'image-from-url.png';
          const file = new File([blob], filename, { type: blob.type });
          
          selectedFile = file;
          isFromUrl = true;
          originalFileName = filename;
          showPreview(file);
          showWarning('Image loaded successfully! Some images may appear different due to CORS restrictions.');
          return;
        } catch (directError) {
          console.log('Direct loading failed, trying proxy services...');
        }
      } catch (directError) {
        console.log('Direct fetch failed, trying proxy services...');
      }

      // Try proxy services
      let lastError = null;
      
      for (const proxy of proxyServices) {
        try {
          urlSubmitBtn.textContent = `Trying ${proxy.name}...`;
          
          const proxyUrl = proxy.url(url);
          const response = await fetch(proxyUrl, {
            headers: proxy.headers,
            timeout: 15000
          });
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const blob = await response.blob();
          
          if (!blob.type.startsWith('image/') && blob.size < 1000) {
            // Likely an error response, not an image
            const text = await blob.text();
            throw new Error(`Invalid response: ${text.substring(0, 100)}`);
          }

          // Extract filename from URL
          const urlPath = new URL(url).pathname;
          const filename = urlPath.split('/').pop() || 'image-from-url';
          
          const file = new File([blob], filename, { type: blob.type || 'image/png' });
          selectedFile = file;
          isFromUrl = true;
          originalFileName = filename;
          showPreview(file);
          showWarning(`Image loaded successfully via ${proxy.name}! Note: Some websites block image loading due to security policies.`);
          return;
          
        } catch (error) {
          console.error(`${proxy.name} failed:`, error);
          lastError = error;
          continue;
        }
      }

      // All methods failed
      console.error('All proxy methods failed:', lastError);
      showError(`Failed to load image from URL. This can happen due to:
        ‚Ä¢ Website blocking external access (CORS policy)
        ‚Ä¢ Invalid or broken image URL
        ‚Ä¢ Network connectivity issues
        
        Try: Download the image and use file upload instead.`);
      
      urlSubmitBtn.disabled = false;
      urlSubmitBtn.textContent = 'Load Image';
    }

    function showPreview(file) {
      if (!validateFile(file)) return;
      
      hideMessages();
      originalFileName = file.name;

      // Show preview image
      const reader = new FileReader();
      reader.onload = (e) => {
        previewImage.src = e.target.result;
      };
      reader.readAsDataURL(file);

      // Set default filename (without extension, as slug)
      const nameWithoutExt = getFileNameWithoutExtension(file.name);
      filenameInput.value = createSlug(nameWithoutExt);

      // Set default format based on original file type
      const fileExtension = getFileExtension(file.name);
      if (['jpg', 'jpeg', 'png', 'webp'].includes(fileExtension)) {
        formatSelect.value = fileExtension === 'jpeg' ? 'jpg' : fileExtension;
      } else {
        formatSelect.value = 'original';
      }

      // Update filename preview
      updateFilenamePreview();

      // Show preview section
      uploadSection.style.display = 'none';
      document.getElementById('urlContent').style.display = 'none';
      previewSection.style.display = 'block';
      
      // Reset URL submit button
      urlSubmitBtn.disabled = false;
      urlSubmitBtn.textContent = 'Load Image';
    }

    async function convertImageFormat(file, targetFormat) {
      if (targetFormat === 'original') {
        return file;
      }

      return new Promise((resolve) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();

        img.onload = () => {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);

          let mimeType, quality;

          switch (targetFormat) {
            case 'jpg':
              mimeType = 'image/jpeg';
              quality = 0.85;
              break;
            case 'webp':
              mimeType = 'image/webp';
              quality = 0.80;
              break;
            case 'png':
              mimeType = 'image/png';
              quality = undefined;
              break;
            default:
              mimeType = `image/${targetFormat}`;
              quality = undefined;
          }

          canvas.toBlob((blob) => {
            const finalFilename = generateFinalFilename(filenameInput.value, selectedFile, targetFormat);
            const convertedFile = new File([blob], finalFilename, { type: mimeType });
            resolve(convertedFile);
          }, mimeType, quality);
        };

        img.src = URL.createObjectURL(file);
      });
    }

    async function uploadImage() {
      if (!selectedFile) return;
      
      hideMessages();
      uploadConfirmBtn.disabled = true;
      uploadConfirmBtn.textContent = 'Processing...';
      progressBar.style.display = 'block';
      updateProgress(10);

      try {
        const selectedFormat = formatSelect.value;
        let fileToUpload = selectedFile;

        if (selectedFormat !== 'original') {
          uploadConfirmBtn.textContent = 'Converting...';
          updateProgress(20);
          fileToUpload = await convertImageFormat(selectedFile, selectedFormat);
        } else {
          // Even for original format, we need to rename the file properly
          const finalFilename = generateFinalFilename(filenameInput.value, selectedFile, selectedFormat);
          fileToUpload = new File([selectedFile], finalFilename, { type: selectedFile.type });
        }

        uploadConfirmBtn.textContent = 'Uploading...';
        updateProgress(40);

        const formData = new FormData();
        formData.append('image', fileToUpload);

        updateProgress(60);
        const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
          method: 'POST',
          body: formData
        });

        updateProgress(80);
        if (!response.ok) {
          throw new Error(`Upload failed: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        updateProgress(90);

        if (data.success) {
          const imageUrl = data.data.url;
          resultImage.src = imageUrl;
          urlResultInput.value = imageUrl;
          previewSection.style.display = 'none';
          resultSection.style.display = 'block';
          updateProgress(100);

          setTimeout(() => {
            progressBar.style.display = 'none';
          }, 500);
        } else {
          throw new Error(data.error?.message || 'Upload failed');
        }
      } catch (error) {
        console.error('Upload error:', error);
        showError(`Upload failed: ${error.message}. Please try again.`);
        uploadConfirmBtn.disabled = false;
        uploadConfirmBtn.textContent = 'Upload';
        progressBar.style.display = 'none';
      }
    }

    // Event listeners
    uploadBtn.addEventListener('click', () => fileInput.click());
    
    fileInput.addEventListener('change', (e) => {
      if (e.target.files[0]) {
        selectedFile = e.target.files[0];
        isFromUrl = false;
        showPreview(selectedFile);
      }
    });

    urlSubmitBtn.addEventListener('click', () => {
      loadImageFromUrl(imageUrlInput.value);
    });

    imageUrlInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        loadImageFromUrl(imageUrlInput.value);
      }
    });

    // Real-time filename preview updates
    filenameInput.addEventListener('input', updateFilenamePreview);
    formatSelect.addEventListener('change', updateFilenamePreview);

    uploadConfirmBtn.addEventListener('click', uploadImage);

    cancelBtn.addEventListener('click', () => {
      resetUI();
      if (isFromUrl) {
        switchTab(urlTab, urlContent);
      } else {
        switchTab(fileTab, fileContent);
      }
    });

    // Drag and drop
    uploadSection.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadSection.classList.add('dragover');
    });

    uploadSection.addEventListener('dragleave', (e) => {
      e.preventDefault();
      uploadSection.classList.remove('dragover');
    });

    uploadSection.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadSection.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        selectedFile = files[0];
        isFromUrl = false;
        showPreview(selectedFile);
      }
    });

    // Copy functionality
    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(urlResultInput.value);
        copyBtn.textContent = 'Copied!';
        copyBtn.classList.add('copied');
        setTimeout(() => {
          copyBtn.textContent = 'Copy';
          copyBtn.classList.remove('copied');
        }, 2000);
      } catch (err) {
        urlResultInput.select();
        document.execCommand('copy');
        copyBtn.textContent = 'Copied!';
        copyBtn.classList.add('copied');
        setTimeout(() => {
          copyBtn.textContent = 'Copy';
          copyBtn.classList.remove('copied');
        }, 2000);
      }
    });

    resetBtn.addEventListener('click', () => {
      resetUI();
      fileInput.value = '';
    });
  </script>
</body>

</html>